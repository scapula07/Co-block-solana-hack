{"ast":null,"code":"import { assertPayloadIsMessageSignatureNeededResponsePayload, ConnectionManager, Platform, PopupEvent, assertPayloadIsSolanaWalletAdapterApproved, DEFAULT_POPUP_HEIGHT_PX, assertPayloadIsTransactionSignatureNeededResponsePayload } from '@fractalwagmi/popup-connection';\nimport { WalletError, WalletNotConnectedError, WalletSignTransactionError, WalletPublicKeyError, WalletConnectionError, WalletSignMessageError } from '@solana/wallet-adapter-base';\nimport { Transaction, PublicKey } from '@solana/web3.js';\nimport base58 from 'bs58';\nimport { createNonce } from \"./nonce.js\";\nconst UNKNOWN_ERROR_MESSAGE = 'Unknown Error';\nconst FRACTAL_DOMAIN_HTTPS = 'https://fractal.is';\nconst APPROVE_PAGE_URL = `${FRACTAL_DOMAIN_HTTPS}/wallet-adapter/approve`;\nconst SIGN_PAGE_URL = `${FRACTAL_DOMAIN_HTTPS}/wallet-adapter/sign`;\nconst SIGN_MESSAGE_PAGE_URL = `${FRACTAL_DOMAIN_HTTPS}/wallet-adapter/sign/message`;\nconst MIN_POPUP_HEIGHT_PX = DEFAULT_POPUP_HEIGHT_PX;\nconst MAX_POPUP_WIDTH_PX = 850;\nconst LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY = 'RdxqNYxF';\nexport class FractalWalletAdapterImpl {\n  constructor() {\n    this.popupManager = new ConnectionManager(Platform.SOLANA_WALLET_ADAPTER);\n    this.publicKey = null;\n    this.connecting = false;\n  }\n  getPublicKey() {\n    return this.publicKey;\n  }\n  async connect() {\n    let resolve;\n    let reject;\n    const publicKeyInLocalStorage = window.localStorage.getItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY);\n    if (publicKeyInLocalStorage) {\n      this.publicKey = new PublicKey(publicKeyInLocalStorage);\n      return Promise.resolve();\n    }\n    const nonce = createNonce();\n    this.popupManager.open({\n      nonce,\n      url: `${APPROVE_PAGE_URL}/${nonce}`\n    });\n    const handleSolanaWalletAdapterApproved = payload => {\n      if (!assertPayloadIsSolanaWalletAdapterApproved(payload)) {\n        reject(new WalletConnectionError('Malformed payload when setting up connection. ' + 'Expected { solanaPublicKey: string } but ' + `received ${JSON.stringify(payload)}`));\n        this.popupManager.close();\n        return;\n      }\n      try {\n        this.publicKey = new PublicKey(payload.solanaPublicKey);\n        window.localStorage.setItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY, payload.solanaPublicKey);\n        resolve();\n      } catch (error) {\n        const publicKeyError = new WalletPublicKeyError(error instanceof Error ? error.message : UNKNOWN_ERROR_MESSAGE, error);\n        reject(publicKeyError);\n      }\n      this.popupManager.close();\n    };\n    const handleExplicitDenialByUser = () => {\n      reject(new WalletConnectionError('The user denied the connection.'));\n      this.popupManager.close();\n    };\n    const handleClosedByUser = () => {\n      reject(new WalletConnectionError('The user denied the connection.'));\n      this.popupManager.close();\n    };\n    this.popupManager.onConnectionUpdated(connection => {\n      if (!connection) {\n        return;\n      }\n      connection.on(PopupEvent.SOLANA_WALLET_ADAPTER_APPROVED, handleSolanaWalletAdapterApproved);\n      connection.on(PopupEvent.SOLANA_WALLET_ADAPTER_DENIED, handleExplicitDenialByUser);\n      connection.on(PopupEvent.POPUP_CLOSED, handleClosedByUser);\n    });\n    return new Promise((promiseResolver, promiseRejector) => {\n      resolve = promiseResolver;\n      reject = promiseRejector;\n    });\n  }\n  async disconnect() {\n    this.popupManager.tearDown();\n    this.publicKey = null;\n    window.localStorage.removeItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY);\n  }\n  async signTransaction(transaction) {\n    try {\n      this.checkWalletReadiness();\n      const result = await this.signTransactions([transaction]);\n      return result[0];\n    } catch (error) {\n      let errorToThrow = error;\n      if (!(error instanceof WalletError)) {\n        errorToThrow = new WalletSignTransactionError(error instanceof Error ? error.message : UNKNOWN_ERROR_MESSAGE, error);\n      }\n      throw errorToThrow;\n    }\n  }\n  async signAllTransactions(transactions) {\n    try {\n      this.checkWalletReadiness();\n      const result = await this.signTransactions(transactions);\n      return result;\n    } catch (error) {\n      let errorToThrow = error;\n      if (!(error instanceof WalletError)) {\n        errorToThrow = new WalletSignTransactionError(error instanceof Error ? error.message : UNKNOWN_ERROR_MESSAGE, error);\n      }\n      throw errorToThrow;\n    }\n  }\n  async signMessage(encodedMessage) {\n    const decodedMessage = new TextDecoder().decode(encodedMessage);\n    let resolve;\n    let reject;\n    const handleMessageSignatureNeededResponse = payload => {\n      if (!assertPayloadIsMessageSignatureNeededResponsePayload(payload)) {\n        const error = new WalletSignMessageError('Malformed payload when signing message. ' + 'Expected { decodedSignature: string } ' + `but received ${JSON.stringify(payload)}`);\n        reject(error);\n        this.popupManager.close();\n        return;\n      }\n      const encodedSignature = Uint8Array.from(payload.decodedSignature.split(',').map(n => Number(n)));\n      resolve(encodedSignature);\n      this.popupManager.close();\n    };\n    const handleClosedOrDeniedByUser = () => {\n      reject(new WalletSignMessageError('The user did not approve the message'));\n      this.popupManager.close();\n    };\n    const handleAuthLoaded = () => {\n      var _a;\n      const payload = {\n        decodedMessage\n      };\n      (_a = this.popupManager.getConnection()) === null || _a === void 0 ? void 0 : _a.send({\n        event: PopupEvent.MESSAGE_SIGNATURE_NEEDED,\n        payload\n      });\n    };\n    const nonce = createNonce();\n    this.popupManager.open({\n      heightPx: Math.max(MIN_POPUP_HEIGHT_PX, Math.floor(window.innerHeight * 0.8)),\n      nonce,\n      url: `${SIGN_MESSAGE_PAGE_URL}/${nonce}`,\n      widthPx: Math.min(MAX_POPUP_WIDTH_PX, Math.floor(window.innerWidth * 0.8))\n    });\n    this.popupManager.onConnectionUpdated(connection => {\n      if (!connection) {\n        return;\n      }\n      connection.on(PopupEvent.MESSAGE_SIGNATURE_NEEDED_RESPONSE, handleMessageSignatureNeededResponse);\n      connection.on(PopupEvent.TRANSACTION_DENIED, handleClosedOrDeniedByUser);\n      connection.on(PopupEvent.POPUP_CLOSED, handleClosedOrDeniedByUser);\n      connection.on(PopupEvent.AUTH_LOADED, handleAuthLoaded);\n    });\n    return new Promise((promiseResolver, promiseRejector) => {\n      resolve = promiseResolver;\n      reject = promiseRejector;\n    });\n  }\n  async signTransactions(transactions) {\n    let resolve;\n    let reject;\n    const handleTransactionSignatureNeededResponse = payload => {\n      if (!assertPayloadIsTransactionSignatureNeededResponsePayload(payload)) {\n        const error = new WalletSignTransactionError('Malformed payload when signing transactions. ' + 'Expected { signedB58Transactions: string[] } ' + `but received ${JSON.stringify(payload)}`);\n        reject(error);\n        this.popupManager.close();\n        return;\n      }\n      const signedTransactions = payload.signedB58Transactions.map(signedB58Transaction => {\n        return Transaction.from(base58.decode(signedB58Transaction));\n      });\n      resolve(signedTransactions);\n      this.popupManager.close();\n    };\n    const handleClosedOrDeniedByUser = () => {\n      reject(new WalletSignTransactionError('The user did not approve the transaction'));\n      this.popupManager.close();\n    };\n    const handleAuthLoaded = () => {\n      var _a;\n      const payload = {\n        unsignedB58Transactions: transactions.map(t => base58.encode(t.serializeMessage()))\n      };\n      (_a = this.popupManager.getConnection()) === null || _a === void 0 ? void 0 : _a.send({\n        event: PopupEvent.TRANSACTION_SIGNATURE_NEEDED,\n        payload\n      });\n    };\n    const nonce = createNonce();\n    this.popupManager.open({\n      heightPx: Math.max(MIN_POPUP_HEIGHT_PX, Math.floor(window.innerHeight * 0.8)),\n      nonce,\n      url: `${SIGN_PAGE_URL}/${nonce}`,\n      widthPx: Math.min(MAX_POPUP_WIDTH_PX, Math.floor(window.innerWidth * 0.8))\n    });\n    this.popupManager.onConnectionUpdated(connection => {\n      if (!connection) {\n        return;\n      }\n      connection.on(PopupEvent.TRANSACTION_SIGNATURE_NEEDED_RESPONSE, handleTransactionSignatureNeededResponse);\n      connection.on(PopupEvent.TRANSACTION_DENIED, handleClosedOrDeniedByUser);\n      connection.on(PopupEvent.POPUP_CLOSED, handleClosedOrDeniedByUser);\n      connection.on(PopupEvent.AUTH_LOADED, handleAuthLoaded);\n    });\n    return new Promise((promiseResolver, promiseRejector) => {\n      resolve = promiseResolver;\n      reject = promiseRejector;\n    });\n  }\n  checkWalletReadiness() {\n    if (this.publicKey === null) {\n      throw new WalletNotConnectedError('`publicKey` is null. Did you forget to call `.connect()`?');\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["assertPayloadIsMessageSignatureNeededResponsePayload","ConnectionManager","Platform","PopupEvent","assertPayloadIsSolanaWalletAdapterApproved","DEFAULT_POPUP_HEIGHT_PX","assertPayloadIsTransactionSignatureNeededResponsePayload","WalletError","WalletNotConnectedError","WalletSignTransactionError","WalletPublicKeyError","WalletConnectionError","WalletSignMessageError","Transaction","PublicKey","base58","createNonce","UNKNOWN_ERROR_MESSAGE","FRACTAL_DOMAIN_HTTPS","APPROVE_PAGE_URL","SIGN_PAGE_URL","SIGN_MESSAGE_PAGE_URL","MIN_POPUP_HEIGHT_PX","MAX_POPUP_WIDTH_PX","LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY","FractalWalletAdapterImpl","constructor","SOLANA_WALLET_ADAPTER","getPublicKey","publicKey","connect","resolve","reject","publicKeyInLocalStorage","window","localStorage","getItem","Promise","nonce","popupManager","open","url","handleSolanaWalletAdapterApproved","payload","JSON","stringify","close","solanaPublicKey","setItem","error","publicKeyError","Error","message","handleExplicitDenialByUser","handleClosedByUser","onConnectionUpdated","connection","on","SOLANA_WALLET_ADAPTER_APPROVED","SOLANA_WALLET_ADAPTER_DENIED","POPUP_CLOSED","promiseResolver","promiseRejector","disconnect","tearDown","removeItem","signTransaction","transaction","checkWalletReadiness","result","signTransactions","errorToThrow","signAllTransactions","transactions","signMessage","encodedMessage","decodedMessage","TextDecoder","decode","handleMessageSignatureNeededResponse","encodedSignature","Uint8Array","from","decodedSignature","split","map","n","Number","handleClosedOrDeniedByUser","handleAuthLoaded","getConnection","send","event","MESSAGE_SIGNATURE_NEEDED","heightPx","Math","max","floor","innerHeight","widthPx","min","innerWidth","MESSAGE_SIGNATURE_NEEDED_RESPONSE","TRANSACTION_DENIED","AUTH_LOADED","handleTransactionSignatureNeededResponse","signedTransactions","signedB58Transactions","signedB58Transaction","unsignedB58Transactions","t","encode","serializeMessage","TRANSACTION_SIGNATURE_NEEDED","TRANSACTION_SIGNATURE_NEEDED_RESPONSE"],"sources":["../../../src/core/fractal-wallet-adapter-impl.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}